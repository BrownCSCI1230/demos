<!DOCTYPE html>
<html lang="en">
<head>
  <title>Subtractive Colormixing</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="index.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

    <div class="dropdown">
    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Canvases</button>
  	<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    <a class="dropdown-item" href="#" onclick="changeCanvas()">Colorfield</a>
    <a class="dropdown-item" href="#" onclick="changePaintCanvas()">Paint Canvas</a>
    <a class="dropdown-item" href="#" onclick="enterURL()">URL Image</a>
  </div>
  </div>

  <div id="urlForm">
  Enter an image URL:
	<input id="url" placeholder="http://250.browndailyherald.com/wp-content/uploads/2014/05/Van-dam_-Alana-Tisdale-700x465.jpg" type="text">
	<button class="btn btn-primary" type="button" href="" id="submitUrl" onclick="changeCanvasURL()">Submit</button>
  </div>

<div class="container">
  <div class="row">
    <div class="col-sm-9" id="app">
    <canvas id="canvas"></canvas>
    </div>
    <div class="col-sm-3">
      <p>Color Components</p>
      <div class="container" id="bars">
      <div class="col-sm-3" id="cyanBar">
      	<div id="cyanColored"></div>
      </div>
      <div class="col-sm-3" id="magentaBar">
      	<div id="magentaColored"></div>
      </div>
      <div class="col-sm-3" id="yellowBar">
      	<div id="yellowColored"></div>
      </div>
      <div class="col-sm-3" id="blackBar">
      	<div id="blackColored"></div>
 
      </div>
      </div>
      <div id="radio">
      	<input type="radio" name="colormode" value="cmy" onchange="updateCMYMode()"/>cmy
      	<input type="radio" name="colormode" value="cmyk" onchange="updateCMYMode()"/>cmyk
      </div>
      <br>
      <p>Color Selector</p>
     <button onclick="changeCyan()" id="cyan">
     	<img src="images/cyanBottleClosed.gif">
     </button>
     <button onclick="changeMagenta()" id="magenta">
     	<img src="images/magentaBottleClosed.gif">
     </button>
     <button onclick="changeYellow()" id="yellow">
     	<img src="images/yellowBottleClosed.gif">
     </button>
      <button onclick="changeBlack()" id="black">
     	<img src="images/blackBottleClosed.gif">
     </button>
      <p>Alpha</p>
      <input type="number" min="0" max="1.0" step="0.01" value="0.1" id="alphaNumber">
      <input type="range" min="0" max="1.0" step="0.01" value="0.1" class="slider" onchange="updateAlpha(this.value)" id="alphaSlider">
    </div>
  </div>
</div>
</body>
<script>
	var alpha = 0.5;
	function updateAlpha(val) {
          document.getElementById('alphaNumber').value=val; 
          alpha = val;
    }

    var cmy = true;
    function updateCMYMode() {
    	var modes = document.getElementsByName('colormode');
    	if(modes[0].checked) {
    		cmy = true;
    	} else {
    		cmy = false;
    	}
    }

 	var canvas = document.getElementById('canvas');
	var ctx = canvas.getContext('2d');
 	var painting = document.getElementById('paint');
 	var windowoffset = window.innerWidth / 8;
  	var width = window.innerWidth - 4 * windowoffset;
  	if(width < 800) {
  		width = 800;
  	}
  	var height = window.innerHeight - windowoffset;
  	if(height < 600) {
  		height = 600;
  	}
	canvas.width = width;
	canvas.height = height;
	canvas.style.border = '1px solid #000';

	var mouse = {x: 0, y: 0};
		 
	ctx.fillStyle = "white";
	ctx.fillRect(0, 0, canvas.width, canvas.height);

	canvas.addEventListener('mousemove', function(e) {
		var x = e.pageX - this.offsetLeft - width / 20; // 30
		var y = e.pageY - this.offsetTop - height / 20; // 10
		var index = (Math.floor(y) * canvas.width + Math.floor(x)) * 4;
		var red = imageData.data[index];
		var green = imageData.data[index + 1];
		var blue = imageData.data[index + 2];
		var alpha = imageData.data[index + 3];
	    if(red == null) {
	    	red = 0;
	    } 
	    if(green == null) {
	    	green = 0;
	    }
	    if(blue == null) {
	    	blue = 0;
	    }

	    var cyanBar = document.getElementById('cyanColored');
		var magentaBar = document.getElementById('magentaColored');
	    var yellowBar = document.getElementById('yellowColored');
	    var blackBar = document.getElementById('blackColored');

	    var colors = null;
	    if(!cmy) {
			colors = rgb2cmyk(red, green, blue);
			// BLACK
			var blackPercent = colors[3] * 100;
			blackBar.style.height = blackPercent + "%";
	    } else {
	    	colors = rgb2cmy(red, green. blue);
	    }
		
	    // CYAN
	    var cyanPercent = colors[0] * 100;
		cyanBar.style.height = cyanPercent + "%";

	    // MAGENTA
	    var magentaPercent = colors[1] * 100;
		magentaBar.style.height = magentaPercent + "%";
	    
	    // YELLOW
	    var yellowPercent = colors[2] * 100;
		yellowBar.style.height = yellowPercent + "%";

	} , false);

	var img = new Image();
	img.src = "images/cymkColorfieldBackground.jpg";
	var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
	img.onload = function () {
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		var imgWidth = canvas.width / 2;
		var imgHeight = canvas.height / 2;
    	ctx.drawImage(img,canvas.width / 4,canvas.height / 4, imgWidth, imgHeight);
		imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
	};
	 
	canvas.addEventListener('mousemove', function(e){
		var offset = (canvas.width / 50);
		mouse.x = e.pageX - this.offsetLeft - offset;
		mouse.y = e.pageY - this.offsetTop;
	}, false); 

var onPaint = function() {
    ctx.lineTo(mouse.x, mouse.y);
    ctx.stroke();
    imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
};

var drawPaint = function(e) {
	    	ctx.beginPath();
	    	ctx.moveTo(mouse.x, mouse.y);
	    	canvas.addEventListener('mousemove', onPaint, false);
}	

var stopPaint = function() {
		    canvas.removeEventListener('mousemove', onPaint, false);	
};	
	
	function changeCyan(e) {
		ctx.strokeStyle = 'rgba(0,255,255,' + alpha +')';
	}

	function changeMagenta(e) {
		ctx.strokeStyle = 'rgba(255,0,255,' + alpha +')';
	}

	function changeYellow(e) {
		ctx.strokeStyle = 'rgba(255,255,0,' + alpha + ')';
	}

	function changeBlack(e) {
		ctx.strokeStyle = 'rgba(0,0,0,' + alpha + ')';
	}

var colorField = true;	
var changeCanvas = function() {
	if(!colorField) {
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		var img = new Image();
		img.src = "images/cymkColorfieldBackground.jpg";
		img.onload = function () {
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
	    	var imgWidth = canvas.width / 2;
			var imgHeight = canvas.height / 2;
    		ctx.drawImage(img,canvas.width / 4,canvas.height / 4, imgWidth, imgHeight);

		};
		canvas.removeEventListener('mousedown', drawPaint);
		canvas.removeEventListener('mouseup', stopPaint);
		colorField = true;
	} else {
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		ctx.lineWidth = 3;
		ctx.lineJoin = 'round';
		ctx.lineCap = 'round';
		ctx.strokeStyle = 'rgba(0,255,255,' + alpha + ')';
		canvas.addEventListener('mousedown', drawPaint, false);
		canvas.addEventListener('mouseup', stopPaint, false);
		colorField = false;
	}
};

var changeColorfield = function() {
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		var img = new Image();
		img.src = "images/rgbColorfieldCanvas.jpg";
		img.onload = function () {
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
	    	var imgWidth = canvas.width / 2;
			var imgHeight = canvas.height / 2;
    		ctx.drawImage(img,canvas.width / 4,canvas.height / 4, imgWidth, imgHeight);

		};
		canvas.removeEventListener('mousedown', drawPaint);
		canvas.removeEventListener('mouseup', stopPaint);
		colorField = true;
};

var changePaintCanvas = function() {
	urlForm.style.display = "none";
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		ctx.lineWidth = 3;
		ctx.lineJoin = 'round';
		ctx.lineCap = 'round';
		ctx.strokeStyle = 'rgba(0,255,255,' + alpha + ')';
		canvas.addEventListener('mousedown', drawPaint, false);
		canvas.addEventListener('mouseup', stopPaint, false);
		colorField = false;
};

var changeCanvasURL = function() {
		var urlStr = document.getElementById('url');
		console.log(urlStr.value);
		ctx.fillStyle = "white";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		var img = new Image();
		img.src = urlStr.value;
		img.onload = function () {
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
	    	var imgWidth = canvas.width / 2;
			var imgHeight = canvas.height / 2;
    		ctx.drawImage(img,canvas.width / 4,canvas.height / 4, imgWidth, imgHeight);

		};
		canvas.removeEventListener('mousedown', drawPaint);
		canvas.removeEventListener('mouseup', stopPaint);
		colorField = true;
};

var enterURL = function() {
	var urlForm = document.getElementById('urlForm');
	if (urlForm.style.display === "none") {
        urlForm.style.display = "block";
    } else {
        urlForm.style.display = "none";
    }
}

function rgb2cmy(r,g,b) {
	var c = 0;
	var m = 0;
	var k = 0;

 c = 1 - (r/255);
 m = 1 - (g/255);
 y = 1 - (b/255);

 return [c, m, y];
}

function rgb2cmyk (r,g,b) {
 var computedC = 0;
 var computedM = 0;
 var computedY = 0;
 var computedK = 0;

 // BLACK
 if (r==0 && g==0 && b==0) {
  computedK = 1;
  return [0,0,0,1];
 }

 computedC = 1 - (r/255);
 computedM = 1 - (g/255);
 computedY = 1 - (b/255);

 var minCMY = Math.min(computedC,
              Math.min(computedM,computedY));
 computedC = (computedC - minCMY) / (1 - minCMY) ;
 computedM = (computedM - minCMY) / (1 - minCMY) ;
 computedY = (computedY - minCMY) / (1 - minCMY) ;
 computedK = minCMY;

 return [computedC,computedM,computedY,computedK];
}

var urlForm = document.getElementById('urlForm');
urlForm.style.display = "none";
 </script>
</html>
